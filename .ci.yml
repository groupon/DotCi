environment:
  language: java
  language_versions: 1.8.0_51
  packages:
    - apache_maven-3.2.3
    - node-v0.10.40

build:
  before:
    - npm config set registry https://registry.npmjs.org
    - npm cache clear
    - npm install
    - git submodule update --init && mkdir docker/plugins.local
  run:
    - mvn install
    - cp -p target/DotCi.hpi docker/plugins.local
    <% if (GIT_URL =~ /groupon\/DotCi/ && DOTCI_TAG =~ /v?[0-9]+\.[0-9]+\.[0-9]+.*/ ) { %>
    - mvn -DskipTests=true release:perform
    <% } %>

plugins:
  - artifacts: 'target/DotCi.*'
